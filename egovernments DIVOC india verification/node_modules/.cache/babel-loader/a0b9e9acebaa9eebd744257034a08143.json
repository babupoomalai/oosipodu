{"ast":null,"code":"var _jsxFileName = \"/Users/bpoomalai/Documents/babu/cowin/egovernments DIVOC india verification/src/components/CertificateStatus/index.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from \"react\";\nimport \"./index.css\";\nimport CertificateValidImg from \"../../assets/img/certificate-valid.svg\";\nimport CertificateInValidImg from \"../../assets/img/certificate-invalid.svg\";\nimport NextArrowImg from \"../../assets/img/next-arrow.svg\"; // import LearnProcessImg from \"../../assets/img/leanr_more_small.png\";\n// import FeedbackSmallImg from \"../../assets/img/feedback-small.png\";\n// import DownloadSmallImg from \"../../assets/img/download-certificate-small.png\";\n\nimport config from \"../../config\";\nimport { pathOr } from \"ramda\";\nimport { CustomButton } from \"../CustomButton\";\nimport { CertificateDetailsPaths } from \"../../constants\";\nimport { useDispatch } from \"react-redux\";\nimport { addEventAction, EVENT_TYPES } from \"../../redux/reducers/events\";\nimport { useHistory } from \"react-router-dom\";\nimport axios from \"axios\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst jsigs = require('jsonld-signatures');\n\nconst {\n  RSAKeyPair\n} = require('crypto-ld');\n\nconst {\n  documentLoaders\n} = require('jsonld');\n\nconst {\n  node: documentLoader\n} = documentLoaders;\n\nconst {\n  contexts\n} = require('security-context');\n\nconst credentialsv1 = require('../../utils/credentials.json');\n\nconst {\n  vaccinationContext\n} = require('vaccination-context');\n\nconst customLoader = url => {\n  console.log(\"checking \" + url);\n  const c = {\n    \"did:india\": config.certificatePublicKey,\n    \"https://example.com/i/india\": config.certificatePublicKey,\n    \"https://w3id.org/security/v1\": contexts.get(\"https://w3id.org/security/v1\"),\n    'https://www.w3.org/2018/credentials#': credentialsv1,\n    \"https://www.w3.org/2018/credentials/v1\": credentialsv1,\n    \"https://cowin.gov.in/credentials/vaccination/v1\": vaccinationContext\n  };\n  let context = c[url];\n\n  if (context === undefined) {\n    context = contexts[url];\n  }\n\n  if (context !== undefined) {\n    return {\n      contextUrl: null,\n      documentUrl: url,\n      document: context\n    };\n  }\n\n  if (url.startsWith(\"{\")) {\n    return JSON.parse(url);\n  }\n\n  console.log(\"Fallback url lookup for document :\" + url);\n  return documentLoader()(url);\n};\n\nexport const CertificateStatus = ({\n  certificateData,\n  goBack\n}) => {\n  _s();\n\n  const [isValid, setValid] = useState(false);\n  const [data, setData] = useState({});\n  const history = useHistory();\n  setTimeout(() => {\n    try {\n      axios.post(\"/divoc/api/v1/events/\", {\n        \"date\": new Date().toISOString(),\n        \"type\": \"verify\"\n      }).catch(e => {\n        console.log(e);\n      });\n    } catch (e) {\n      console.log(e);\n    }\n  }, 100);\n  const dispatch = useDispatch();\n  useEffect(() => {\n    async function verifyData() {\n      try {\n        const signedJSON = JSON.parse(certificateData);\n        const publicKey = {\n          '@context': jsigs.SECURITY_CONTEXT_URL,\n          id: 'did:india',\n          type: 'RsaVerificationKey2018',\n          controller: 'https://cowin.gov.in/',\n          publicKeyPem: config.certificatePublicKey\n        };\n        const controller = {\n          '@context': jsigs.SECURITY_CONTEXT_URL,\n          id: 'https://cowin.gov.in/',\n          publicKey: [publicKey],\n          // this authorizes this key to be used for making assertions\n          assertionMethod: [publicKey.id]\n        };\n        const key = new RSAKeyPair({ ...publicKey\n        });\n        const {\n          AssertionProofPurpose\n        } = jsigs.purposes;\n        const {\n          RsaSignature2018\n        } = jsigs.suites;\n        const result = await jsigs.verify(signedJSON, {\n          suite: new RsaSignature2018({\n            key\n          }),\n          purpose: new AssertionProofPurpose({\n            controller\n          }),\n          documentLoader: customLoader,\n          compactProof: false\n        });\n\n        if (result.verified) {\n          const revokedResponse = await checkIfRevokedCertificate(signedJSON);\n\n          if (revokedResponse.response.status !== 200) {\n            console.log('Signature verified.');\n            setValid(true);\n            setData(signedJSON);\n            dispatch(addEventAction({\n              type: EVENT_TYPES.VALID_VERIFICATION,\n              extra: signedJSON.credentialSubject\n            }));\n            return;\n          }\n        }\n\n        dispatch(addEventAction({\n          type: EVENT_TYPES.INVALID_VERIFICATION,\n          extra: signedJSON\n        }));\n        setValid(false);\n      } catch (e) {\n        console.log('Invalid data', e);\n        setValid(false);\n        dispatch(addEventAction({\n          type: EVENT_TYPES.INVALID_VERIFICATION,\n          extra: certificateData\n        }));\n      }\n    }\n\n    verifyData();\n  }, []);\n\n  async function checkIfRevokedCertificate(data) {\n    return axios.post(\"/divoc/api/v1/certificate/revoked\", data).then(res => {\n      dispatch(addEventAction({\n        type: EVENT_TYPES.REVOKED_CERTIFICATE,\n        extra: certificateData\n      }));\n      return res;\n    }).catch(e => {\n      console.log(e);\n      return e;\n    });\n  }\n\n  function getCertificateStatusAsString(data) {\n    if (!data || !data[\"evidence\"]) {\n      return \"\";\n    }\n\n    const dose = data[\"evidence\"][0][\"dose\"];\n    const totalDoses = data[\"evidence\"][0][\"totalDoses\"] || 2;\n\n    if (dose === totalDoses) {\n      return \"Final Certificate for COVID-19 Vaccination\";\n    } else {\n      return \"Provisional Certificate for COVID-19 Vaccination (1st Dose)\";\n    }\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"certificate-status-wrapper\",\n    children: [/*#__PURE__*/_jsxDEV(\"img\", {\n      src: isValid ? CertificateValidImg : CertificateInValidImg,\n      alt: \"\",\n      className: \"certificate-status-image\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 155,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n      className: \"certificate-status\",\n      children: isValid ? \"Certificate Successfully Verified\" : \"Certificate Invalid\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 13\n    }, this), isValid && /*#__PURE__*/_jsxDEV(\"h5\", {\n      children: getCertificateStatusAsString(data)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 28\n    }, this), isValid && /*#__PURE__*/_jsxDEV(\"table\", {\n      className: \"mt-3\",\n      children: Object.keys(CertificateDetailsPaths).map((key, index) => {\n        const context = CertificateDetailsPaths[key];\n        return /*#__PURE__*/_jsxDEV(\"tr\", {\n          style: {\n            fontSize: \"smaller\",\n            textAlign: \"left\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"td\", {\n            className: \"pr-3\",\n            children: key\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 177,\n            columnNumber: 37\n          }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n            className: \"font-weight-bolder\",\n            children: context.format(pathOr(\"NA\", context.path, data))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 178,\n            columnNumber: 37\n          }, this)]\n        }, index, true, {\n          fileName: _jsxFileName,\n          lineNumber: 176,\n          columnNumber: 33\n        }, this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 28\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(CustomButton, {\n      className: \"blue-btn m-3\",\n      onClick: goBack,\n      children: \"Verify Another Certificate\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 154,\n    columnNumber: 9\n  }, this);\n};\n\n_s(CertificateStatus, \"zwjx57ZjYdiHiRFdUZfOwq0K6fA=\", false, function () {\n  return [useHistory, useDispatch];\n});\n\n_c = CertificateStatus;\nexport const SmallInfoCards = ({\n  text,\n  img,\n  onClick,\n  backgroundColor\n}) => /*#__PURE__*/_jsxDEV(\"div\", {\n  className: \"small-info-card-wrapper mt-3 mb-3\",\n  style: {\n    backgroundColor: backgroundColor\n  },\n  children: [/*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"w-50 \",\n    children: /*#__PURE__*/_jsxDEV(\"img\", {\n      src: img,\n      alt: \"\",\n      className: \"small-card-img float-right\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 204,\n    columnNumber: 9\n  }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n    onClick: onClick,\n    className: \"w-50 d-flex flex-column align-items-start justify-content-center font-weight-bold\",\n    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n      children: text\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"img\", {\n      src: NextArrowImg,\n      alt: \"\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 207,\n    columnNumber: 9\n  }, this)]\n}, void 0, true, {\n  fileName: _jsxFileName,\n  lineNumber: 203,\n  columnNumber: 5\n}, this);\n_c2 = SmallInfoCards;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"CertificateStatus\");\n$RefreshReg$(_c2, \"SmallInfoCards\");","map":{"version":3,"sources":["/Users/bpoomalai/Documents/babu/cowin/egovernments DIVOC india verification/src/components/CertificateStatus/index.js"],"names":["React","useEffect","useState","config","pathOr","CustomButton","CertificateDetailsPaths","useDispatch","addEventAction","EVENT_TYPES","useHistory","axios","jsigs","require","RSAKeyPair","documentLoaders","node","documentLoader","contexts","credentialsv1","vaccinationContext","customLoader","url","console","log","c","certificatePublicKey","get","context","undefined","contextUrl","documentUrl","document","startsWith","JSON","parse","CertificateStatus","certificateData","goBack","isValid","setValid","data","setData","history","setTimeout","post","Date","toISOString","catch","e","dispatch","verifyData","signedJSON","publicKey","SECURITY_CONTEXT_URL","id","type","controller","publicKeyPem","assertionMethod","key","AssertionProofPurpose","purposes","RsaSignature2018","suites","result","verify","suite","purpose","compactProof","verified","revokedResponse","checkIfRevokedCertificate","response","status","VALID_VERIFICATION","extra","credentialSubject","INVALID_VERIFICATION","then","res","REVOKED_CERTIFICATE","getCertificateStatusAsString","dose","totalDoses","CertificateValidImg","CertificateInValidImg","Object","keys","map","index","fontSize","textAlign","format","path","SmallInfoCards","text","img","onClick","backgroundColor","NextArrowImg"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from \"react\";\nimport \"./index.css\";\nimport CertificateValidImg from \"../../assets/img/certificate-valid.svg\";\nimport CertificateInValidImg from \"../../assets/img/certificate-invalid.svg\";\nimport NextArrowImg from \"../../assets/img/next-arrow.svg\";\n// import LearnProcessImg from \"../../assets/img/leanr_more_small.png\";\n// import FeedbackSmallImg from \"../../assets/img/feedback-small.png\";\n// import DownloadSmallImg from \"../../assets/img/download-certificate-small.png\";\nimport config from \"../../config\";\nimport {pathOr} from \"ramda\";\nimport {CustomButton} from \"../CustomButton\";\nimport {CertificateDetailsPaths} from \"../../constants\";\nimport {useDispatch} from \"react-redux\";\nimport {addEventAction, EVENT_TYPES} from \"../../redux/reducers/events\";\nimport {useHistory} from \"react-router-dom\";\nimport axios from \"axios\";\n\nconst jsigs = require('jsonld-signatures');\nconst {RSAKeyPair} = require('crypto-ld');\nconst {documentLoaders} = require('jsonld');\nconst {node: documentLoader} = documentLoaders;\nconst {contexts} = require('security-context');\nconst credentialsv1 = require('../../utils/credentials.json');\nconst {vaccinationContext} = require('vaccination-context');\n\nconst customLoader = url => {\n    console.log(\"checking \" + url);\n    const c = {\n        \"did:india\": config.certificatePublicKey,\n        \"https://example.com/i/india\": config.certificatePublicKey,\n        \"https://w3id.org/security/v1\": contexts.get(\"https://w3id.org/security/v1\"),\n        'https://www.w3.org/2018/credentials#': credentialsv1,\n        \"https://www.w3.org/2018/credentials/v1\": credentialsv1,\n        \"https://cowin.gov.in/credentials/vaccination/v1\": vaccinationContext,\n    };\n    let context = c[url];\n    if (context === undefined) {\n        context = contexts[url];\n    }\n    if (context !== undefined) {\n        return {\n            contextUrl: null,\n            documentUrl: url,\n            document: context\n        };\n    }\n    if (url.startsWith(\"{\")) {\n        return JSON.parse(url);\n    }\n    console.log(\"Fallback url lookup for document :\" + url)\n    return documentLoader()(url);\n};\n\nexport const CertificateStatus = ({certificateData, goBack}) => {\n    const [isValid, setValid] = useState(false);\n    const [data, setData] = useState({});\n    const history = useHistory();\n\n    setTimeout(()=>{\n        try {\n            axios\n              .post(\"/divoc/api/v1/events/\", {\"date\":new Date().toISOString(), \"type\":\"verify\"})\n              .catch((e) => {\n                console.log(e);\n            });\n        } catch (e) {\n            console.log(e);\n        }\n    }, 100)\n\n    const dispatch = useDispatch();\n    useEffect(() => {\n        async function verifyData() {\n            try {\n                const signedJSON = JSON.parse(certificateData);\n                const publicKey = {\n                    '@context': jsigs.SECURITY_CONTEXT_URL,\n                    id: 'did:india',\n                    type: 'RsaVerificationKey2018',\n                    controller: 'https://cowin.gov.in/',\n                    publicKeyPem: config.certificatePublicKey\n                };\n                const controller = {\n                    '@context': jsigs.SECURITY_CONTEXT_URL,\n                    id: 'https://cowin.gov.in/',\n                    publicKey: [publicKey],\n                    // this authorizes this key to be used for making assertions\n                    assertionMethod: [publicKey.id]\n                };\n                const key = new RSAKeyPair({...publicKey});\n                const {AssertionProofPurpose} = jsigs.purposes;\n                const {RsaSignature2018} = jsigs.suites;\n                const result = await jsigs.verify(signedJSON, {\n                    suite: new RsaSignature2018({key}),\n                    purpose: new AssertionProofPurpose({controller}),\n                    documentLoader: customLoader,\n                    compactProof: false\n                });\n                if (result.verified) {\n                    const revokedResponse = await checkIfRevokedCertificate(signedJSON)\n                    if (revokedResponse.response.status !== 200) {\n                        console.log('Signature verified.');\n                        setValid(true);\n                        setData(signedJSON);\n                        dispatch(addEventAction({\n                            type: EVENT_TYPES.VALID_VERIFICATION,\n                            extra: signedJSON.credentialSubject\n                        }));\n                        return;\n                    }\n                }\n                dispatch(addEventAction({type: EVENT_TYPES.INVALID_VERIFICATION, extra: signedJSON}));\n                setValid(false);\n            } catch (e) {\n                console.log('Invalid data', e);\n                setValid(false);\n                dispatch(addEventAction({type: EVENT_TYPES.INVALID_VERIFICATION, extra: certificateData}));\n\n            }\n\n        }\n\n        verifyData()\n\n    }, []);\n\n    async function checkIfRevokedCertificate(data) {\n        return axios\n            .post(\"/divoc/api/v1/certificate/revoked\", data)\n            .then((res) => {\n                dispatch(addEventAction({type: EVENT_TYPES.REVOKED_CERTIFICATE, extra: certificateData}));\n                return res\n            }).catch((e) => {\n                console.log(e);\n                return e\n            });\n    }\n\n    function getCertificateStatusAsString(data) {\n        if (!data || !data[\"evidence\"]) {\n            return \"\"\n        }\n\n        const dose = data[\"evidence\"][0][\"dose\"]\n        const totalDoses = data[\"evidence\"][0][\"totalDoses\"] || 2\n\n        if (dose === totalDoses) {\n            return \"Final Certificate for COVID-19 Vaccination\"\n        } else {\n            return \"Provisional Certificate for COVID-19 Vaccination (1st Dose)\"\n        }\n    }\n    return (\n        <div className=\"certificate-status-wrapper\">\n            <img src={isValid ? CertificateValidImg : CertificateInValidImg} alt={\"\"}\n                 className=\"certificate-status-image\"/>\n            <h3 className=\"certificate-status\">\n                {\n                    isValid ? \"Certificate Successfully Verified\" : \"Certificate Invalid\"\n                }\n            </h3>\n            <br/>\n            {\n                isValid && <h5>\n                    {\n                        getCertificateStatusAsString(data)\n                    }\n                </h5>\n            }\n            {\n                isValid && <table className=\"mt-3\">\n                    {\n                        Object.keys(CertificateDetailsPaths).map((key, index) => {\n                            const context = CertificateDetailsPaths[key];\n                            return (\n                                <tr key={index} style={{fontSize:\"smaller\", textAlign: \"left\"}}>\n                                    <td className=\"pr-3\" >{key}</td>\n                                    <td className=\"font-weight-bolder\">{context.format(pathOr(\"NA\", context.path, data))}</td>\n                                </tr>\n                            )\n                        })\n                    }\n\n                </table>\n            }\n            <br/>\n            <CustomButton className=\"blue-btn m-3\" onClick={goBack}>Verify Another Certificate</CustomButton>\n            {/*<SmallInfoCards text={\"Provide Feedback\"}*/}\n            {/*                onClick={() => {*/}\n            {/*                    history.push(\"/side-effects\")*/}\n            {/*                }}*/}\n            {/*                img={FeedbackSmallImg} backgroundColor={\"#FFFBF0\"}/>*/}\n            {/*<SmallInfoCards text={\"Learn about the Vaccination process\"} img={LearnProcessImg}*/}\n            {/*               onClick={() => {*/}\n            {/*                    history.push(\"/learn\")*/}\n            {/*                }}*/}\n            {/*                backgroundColor={\"#EFF5FD\"}/>*/}\n        </div>\n    )\n};\n\nexport const SmallInfoCards = ({text, img, onClick, backgroundColor}) => (\n    <div className=\"small-info-card-wrapper mt-3 mb-3\" style={{backgroundColor: backgroundColor}}>\n        <div className=\"w-50 \">\n            <img src={img} alt={\"\"} className=\"small-card-img float-right\"/>\n        </div>\n        <div onClick={onClick}\n             className=\"w-50 d-flex flex-column align-items-start justify-content-center font-weight-bold\">\n            <span>{text}</span>\n            <img src={NextArrowImg} alt={\"\"}/>\n        </div>\n    </div>\n);\n"]},"metadata":{},"sourceType":"module"}